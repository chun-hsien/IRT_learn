---
title: "comparison of RSM and PCM"
author: "Chun Hsien Wu"
date: "2021年12月13日"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
2021.12.14
learning TAM package's function about comparison of RSM and PCM
 website https://bookdown.org/dkatz/Rasch_Biome/polytomous-items.html#polytymous-item-types-and-the-partial-credit-model
```{r}
library(TAM)
setwd("/home/son/刻意練習/統計模擬_實做/Measuring_what_matters")

hls2 <- read.csv("https://raw.githubusercontent.com/danielbkatz/DBER_Rasch-data/master/data/hls_poly_scale.csv")

View(hls2)
```
 hls2's dimension is 317*16
學習用 apply function 把資料集 各個試題答題得分的個數加總 呈現

```{r}
apply(hls2, 2, table)
```
the author mentioned that TAM will automatically run the PCM when our data is polytomous. (Now, I got it!)
```{r}
mod2 <- tam(hls2)
summary(mod2)
```

two forms of Partial Credit Model: 

$\theta$ is the latent trait of person $n$.

$X_i$ means person $n$ get $X$ points ($x$ = 0,1, ..., $m_i$) on item i.

$P(X_{ni} = x) = \frac{exp[\sum_{k=0}^x(\theta_n-\delta_{ik})]}{\sum_{h=0}^{m_i}exp[\sum_{k=0}^h(\theta_n-\delta_{ik})]}$

The second form of Partial Credit Model

$P(X_{ni} = x) = \frac{exp[\sum_{k=0}^x(\theta_n-\delta_{i}+\tau_{ik})]}{\sum_{h=0}^{m_i}exp[\sum_{k=0}^h(\theta_n-\delta_{i} + \tau_{ik})]}$

$\delta_{i}$是整體試題難度.$\tau_{ik}$ 為試題 $i$ 在第 $j$ 閾值的難度

# Item difficulty
```{r}
# Deltas
xsi <- mod2$xsi
xsi
```
Here, TAM's xsi result is actually $\delta_{ik}$. This is item difficulty.

Note that, $\delta_{ik}=\delta_{i}-\tau_{ik}$. In TAM'result.

beta is exactly $\delta_{i}$, tau.Cat1 is $\tau_{i1}$, tau.Cat2 is $\tau_{i2}$, respectively.
```{r}
# Delta-tau parameters
delta_tau <- mod2$item_irt
delta_tau
```
We can see that Hls1_Cat1, Hls1_Cat2 and Hls1_Cat3' value are -1.847, 2.298 and 3.83 respectively.

Now, we can look at Hls1, beta equals 1.4275. It refers to item difficulty. Tau.Cat1, tau.Cat2 and tau.Cat3's value is -3.2736.5, 0.87077 and 2.402828, respectively.

Then Hls1_Cat1 =-1.847 = beta + tau.Cat1 = 1.4275 + -3.273605
```{r}
mod2$item #PCM2 type parameteris
```
# Person ability estimates
```{r}
WLE.ability.poly <- tam.wle(mod2)
```

```{r}
person.ability.poly <- WLE.ability.poly$theta
head(person.ability.poly)
```

# Item fit statistics
```{r}
Fit.poly <- tam.fit(mod2)
```
```{r}
Fit.poly$itemfit
```

